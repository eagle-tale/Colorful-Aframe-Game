<!DOCTYPE html>
<html>
  <head>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-event-set-component@4.2.1/dist/aframe-event-set-component.min.js"></script>
  </head>
  <body>
    <div style="position: fixed; top: 10px; left: 10px; color: white; z-index: 100">
      Score: <span id="score">0</span>
    </div>
    <div
      id="watch"
      style="position: fixed; bottom: 10px; left: 50%; color: white; z-index: 100; transform: translateX(-50%)"
    ></div>
    <div style="position: fixed; top: 10px; right: 10px; color: white; z-index: 100">
      Time: <span id="timer">20</span>
    </div>

    <script>
      const watch = document.getElementById('watch');

      function getCurrentTime() {
        const date = new Date();
        return date.toLocaleTimeString();
      }

      function updateClock() {
        const currentTime = getCurrentTime();
        watch.innerHTML = currentTime;
      }

      updateClock();
      setInterval(updateClock, 1000);
    </script>

    <a-scene>
      <a-sky color="#6EBAA7"></a-sky>
      <a-box
        position="0 0.5 -3"
        rotation="0 45 0"
        color="#4CC3D9"
        id="box"
        click-listener
        event-set__mouseenter="_target: #box; color:red"
      ></a-box>
      <a-camera><a-cursor></a-cursor></a-camera>

      <!-- 空のエンティティをオブジェクトの親として配置 -->
      <a-entity id="objects"></a-entity>
    </a-scene>
  </body>

  <script>
    var score = 0;
    var timeLeft = 20;

    // スコア更新関数
    function updateScore() {
      score++;
      document.getElementById('score').innerText = score;
    }

    // タイマー関数
    function startTimer() {
      var timerInterval = setInterval(function () {
        timeLeft--;
        document.getElementById('timer').innerText = timeLeft;
        if (timeLeft <= 0) {
          clearInterval(timerInterval);
          alert('Game Over! Your score: ' + score);
        }
      }, 1000);
    }

    // クリックされた時の挙動
    AFRAME.registerComponent('click-listener', {
      init: function () {
        this.el.addEventListener('click', function (evt) {
          // this.setAttribute('visible', false); //見えなくなる
          this.parentNode.removeChild(this); // 完全に削除する
          updateScore(); // スコアを加算
          createObject(); // 新たなオブジェクトを生成
        });
      },
    });

    function createObject() {
      // 新しいオブジェクトを作成
      var newObject = document.createElement('a-box');
      // ランダムな位置、色、サイズを設定
      newObject.setAttribute('position', {
        x: (Math.random() - 0.5) * 10,
        y: (Math.random() - 0.5) * 10,
        z: (Math.random() - 0.5) * 10,
      });
      newObject.setAttribute('color', '#' + Math.floor(Math.random() * 16777215).toString(16));
      // newObject.setAttribute('event-set__click', 'visible: false');
      newObject.setAttribute('click-listener', '');
      newObject.setAttribute('event-set__mouseenter', 'color:#' + Math.floor(Math.random() * 16777215).toString(16));

      //シーンにオブジェクトを追加
      document.querySelector('#objects').appendChild(newObject);
    }

    // ゲーム開始時にオブジェクトを生成
    for (let i = 0; i < 20; i++) {
      createObject();
    }

    // ゲーム開始時にタイマーを起動
    startTimer();
  </script>
</html>
